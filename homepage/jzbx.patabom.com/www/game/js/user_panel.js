(function(){if(!a){var a=(function(){var g={};var b="theia";var d=[];var c=200;var f;g[b]={IE:/msie/i.test(navigator.userAgent),E:function(h){if(typeof h==="string"){return document.getElementById(h)}else{return h}},C:function(h){var i;h=h.toUpperCase();if(h=="TEXT"){i=document.createTextNode("")}else{if(h=="BUFFER"){i=document.createDocumentFragment()}else{i=document.createElement(h)}}return i},log:function(){var n,m=arguments,j=m.length,i=[].slice.apply(m,[0,j]),k="error",h;while(i[--j]){if(i[j] instanceof Error){n=i.splice(j,1)[0];break}}if(!n){n=new Error();k="log"}h=[i,k,new Date().getTime(),n.message,n.stack];if(f){try{f.apply(null,h)}catch(o){}}else{d.length>=c&&d.shift();d.push(h)}},_regLogFn:function(h){f=h},_clearLogList:function(){return d.splice(0,d.length)}};var e=g[b];e.register=function(m,h,l){if(!l||typeof l!="string"){l=b}if(!g[l]){g[l]={}}var j=g[l];var o=m.split(".");var n=j;var i=null;while(i=o.shift()){if(o.length){if(n[i]===undefined){n[i]={}}n=n[i]}else{if(n[i]===undefined){try{if(l&&l!==b){if(m==="core.util.listener"){n[i]=g[b].core.util.listener;return true}if(m==="core.util.connect"){n[i]=g[b].core.util.connect;return true}}n[i]=h(j);return true}catch(p){setTimeout(function(){console.log(p)},0)}}}}return false};e.unRegister=function(l,j){if(!j||typeof j!="string"){j=b}var i=g[j];var n=l.split(".");var m=i;var h=null;while(h=n.shift()){if(n.length){if(m[h]===undefined){return false}m=m[h]}else{if(m[h]!==undefined){delete m[h];return true}}}return false};e.regShort=function(h,i){if(e[h]!==undefined){throw"["+h+"] : short : has been register"}e[h]=i};e.shortRegister=function(m,h,l){if(!l||typeof l!="string"){l=b}var j=g[l];var o=m.split(".");if(!h){return false}if(j[h]){return false}var n=j;var i=null;while(i=o.shift()){if(o.length){if(n[i]===undefined){return false}n=n[i]}else{if(n[i]!==undefined){if(j[h]){return false}j[h]=n[i];return true}}}return false};e.getPKG=function(h){if(!h||typeof h!="string"){h=b}return g[h]};return e})()}a.register("core.dom.isNode",function(b){return function(c){return(c!=undefined)&&Boolean(c.nodeName)&&Boolean(c.nodeType)}});a.register("core.evt.addEvent",function(b){return function(e,d,c){e=b.E(e);if(e==null){return false}if(typeof c!=="function"){return false}if(e.addEventListener){e.addEventListener(d,c,false)}else{if(e.attachEvent){e.attachEvent("on"+d,c)}else{e["on"+d]=c}}return true}});a.register("core.util.browser",function(i){var b=navigator.userAgent.toLowerCase();var l=window.external||"";var d,f,g,n,h;var c=function(e){var m=0;return parseFloat(e.replace(/\./g,function(){return(m++==1)?"":"."}))};try{if((/windows|win32/i).test(b)){h="windows"}else{if((/macintosh/i).test(b)){h="macintosh"}else{if((/rhino/i).test(b)){h="rhino"}}}if((f=b.match(/applewebkit\/([^\s]*)/))&&f[1]){d="webkit";n=c(f[1])}else{if((f=b.match(/presto\/([\d.]*)/))&&f[1]){d="presto";n=c(f[1])}else{if(f=b.match(/msie\s([^;]*)/)){d="trident";n=1;if((f=b.match(/trident\/([\d.]*)/))&&f[1]){n=c(f[1])}}else{if(/gecko/.test(b)){d="gecko";n=1;if((f=b.match(/rv:([\d.]*)/))&&f[1]){n=c(f[1])}}}}}if(/world/.test(b)){g="world"}else{if(/360se/.test(b)){g="360"}else{if((/maxthon/.test(b))||typeof l.max_version=="number"){g="maxthon"}else{if(/tencenttraveler\s([\d.]*)/.test(b)){g="tt"}else{if(/se\s([\d.]*)/.test(b)){g="sogou"}}}}}}catch(k){}var j={OS:h,CORE:d,Version:n,EXTRA:(g?g:false),IE:/msie/.test(b),OPERA:/opera/.test(b),MOZ:/gecko/.test(b)&&!/(compatible|webkit)/.test(b),IE5:/msie 5 /.test(b),IE55:/msie 5.5/.test(b),IE6:/msie 6/.test(b),IE7:/msie 7/.test(b),IE8:/msie 8/.test(b),IE9:/msie 9/.test(b),IE10:/msie 10/.test(b),SAFARI:!/chrome\/([\d.]*)/.test(b)&&/\/([\da-f.]*) safari/.test(b),CHROME:/chrome\/([\d.]*)/.test(b),IPAD:/\(ipad/i.test(b),IPHONE:/\(iphone/i.test(b),ITOUCH:/\(itouch/i.test(b),MOBILE:/mobile/i.test(b)};return j});a.register("core.func.getType",function(b){return function(c){var d;return((d=typeof(c))=="object"?c==null&&"null"||Object.prototype.toString.call(c).slice(8,-1):d).toLowerCase()}});a.register("core.dom.ready",function(h){var d=[];var m=false;var l=h.core.func.getType;var i=h.core.util.browser;var g=h.core.evt.addEvent;var j=function(){if(!m){if(document.readyState==="complete"){return true}}return m};var e=function(){if(m==true){return}m=true;for(var o=0,n=d.length;o<n;o++){if(l(d[o])==="function"){try{d[o].call()}catch(p){}}}d=[]};var b=function(){if(j()){e();return}try{document.documentElement.doScroll("left")}catch(n){setTimeout(arguments.callee,25);return}e()};var c=function(){if(j()){e();return}setTimeout(arguments.callee,25)};var f=function(){g(document,"DOMContentLoaded",e)};var k=function(){g(window,"load",e)};if(!j()){if(h.IE&&window===window.top){b()}f();c();k()}return function(n){if(j()){if(l(n)==="function"){n.call()}}else{d.push(n)}}});a.register("core.dom.setStyle",function(c){function b(){if("y" in b){return b.y}return b.y=("filters" in c.C("div"))}return function(d,e,f){if(b()){switch(e){case"opacity":d.style.filter="alpha(opacity="+(f*100)+")";if(!d.currentStyle||!d.currentStyle.hasLayout){d.style.zoom=1}break;case"float":e="styleFloat";default:d.style[e]=f}}else{if(e=="float"){e="cssFloat"}d.style[e]=f}}});a.register("core.dom.getStyle",function(c){function b(){if("y" in b){return b.y}return b.y=("filters" in c.C("div"))}return function(f,h){if(b()){switch(h){case"opacity":var j=100;try{j=f.filters["DXImageTransform.Microsoft.Alpha"].opacity}catch(i){try{j=f.filters("alpha").opacity}catch(i){}}return j/100;case"float":h="styleFloat";default:var g=f.currentStyle?f.currentStyle[h]:null;return(f.style[h]||g)}}else{if(h=="float"){h="cssFloat"}try{var d=document.defaultView.getComputedStyle(f,"")}catch(i){}return f.style[h]||d?d[h]:null}}});a.register("core.dom.hasClassName",function(b){return function(d,c){return(new RegExp("(^|\\s)"+c+"($|\\s)").test(d.className))}});a.register("core.str.trim",function(b){return function(f){if(typeof f!=="string"){throw"trim need a string as parameter"}var c=f.length;var e=0;var d=/(\u3000|\s|\t|\u00A0)/;while(e<c){if(!d.test(f.charAt(e))){break}e+=1}while(c>e){if(!d.test(f.charAt(c-1))){break}c-=1}return f.slice(e,c)}});a.register("core.dom.addClassName",function(b){return function(d,c){if(d.nodeType===1){if(!b.core.dom.hasClassName(d,c)){d.className=b.core.str.trim(d.className)+" "+c}}}});a.register("core.dom.removeClassName",function(b){return function(d,c){if(d.nodeType===1){if(b.core.dom.hasClassName(d,c)){d.className=d.className.replace(new RegExp("(^|\\s)"+c+"($|\\s)")," ")}}}});a.register("core.dom.contains",function(b){return function(c,d){if(c===d){return false}else{if(c.compareDocumentPosition){return((c.compareDocumentPosition(d)&16)===16)}else{if(c.contains&&d.nodeType===1){return c.contains(d)}else{while(d=d.parentNode){if(c===d){return true}}}}}return false}});a.register("core.util.scrollPos",function(b){return function(e){e=e||document;var c=e.documentElement;var d=e.body;return{top:Math.max(window.pageYOffset||0,c.scrollTop,d.scrollTop),left:Math.max(window.pageXOffset||0,c.scrollLeft,d.scrollLeft)}}});a.register("core.obj.parseParam",function(b){return function(e,d,c){var f,g={};d=d||{};for(f in e){g[f]=e[f];if(d[f]!=null){if(c){if(e.hasOwnProperty(f)){g[f]=d[f]}}else{g[f]=d[f]}}}return g}});a.register("core.dom.position",function(d){var b=function(h){var i,g,f,e,k,j;i=h.getBoundingClientRect();g=d.core.util.scrollPos();f=h.ownerDocument.body;e=h.ownerDocument.documentElement;k=e.clientTop||f.clientTop||0;j=e.clientLeft||f.clientLeft||0;return{l:parseInt(i.left+g.left-j,10)||0,t:parseInt(i.top+g.top-k,10)||0}};var c=function(g,e){var h,f;h=[g.offsetLeft,g.offsetTop];f=g.offsetParent;if(f!==g&&f!==e){while(f){h[0]+=f.offsetLeft;h[1]+=f.offsetTop;f=f.offsetParent}}if(d.core.util.browser.OPERA!=-1||(d.core.util.browser.SAFARI!=-1&&g.style.position=="absolute")){h[0]-=document.body.offsetLeft;h[1]-=document.body.offsetTop}if(g.parentNode){f=g.parentNode}else{f=null}while(f&&!/^body|html$/i.test(f.tagName)&&f!==e){if(f.style.display.search(/^inline|table-row.*$/i)){h[0]-=f.scrollLeft;h[1]-=f.scrollTop}f=f.parentNode}return{l:parseInt(h[0],10),t:parseInt(h[1],10)}};return function(g,e){if(g==document.body){return false}if(g.parentNode==null){return false}if(g.style.display=="none"){return false}var f=d.core.obj.parseParam({parent:null},e);if(g.getBoundingClientRect){if(f.parent){var i=b(g);var h=b(f.parent);return{l:i.l-h.l,t:i.t-h.t}}else{return b(g)}}else{return c(g,f.parent||document.body)}}});a.register("core.arr.isArray",function(b){return function(c){return Object.prototype.toString.call(c)==="[object Array]"}});a.register("core.arr.foreach",function(d){var b=function(k,g){var j=[];for(var h=0,f=k.length;h<f;h+=1){var e=g(k[h],h);if(e===false){break}else{if(e!==null){j[h]=e}}}return j};var c=function(i,f){var h={};for(var g in i){var e=f(i[g],g);if(e===false){break}else{if(e!==null){h[g]=e}}}return h};return function(f,e){if(d.core.arr.isArray(f)||(f.length&&f[0]!==undefined)){return b(f,e)}else{if(typeof f==="object"){return c(f,e)}}return null}});a.register("core.evt.removeEvent",function(b){return function(e,d,c){e=b.E(e);if(e==null){return false}if(typeof c!=="function"){return false}if(e.removeEventListener){e.removeEventListener(d,c,false)}else{if(e.detachEvent){e.detachEvent("on"+d,c)}}e["on"+d]=null;return true}});a.register("core.evt.getEvent",function(b){return(function(){if(document.addEventListener){return function(){var d=arguments.callee;var c;do{c=d.arguments[0];if(c&&(c.constructor==Event||c.constructor==MouseEvent||c.constructor==KeyboardEvent)){return c}}while(d=d.caller);return c}}else{return function(e,d,c){return window.event}}}())});a.register("core.evt.stopEvent",function(b){return function(c){c=c||b.core.evt.getEvent();if(c.preventDefault){c.preventDefault();c.stopPropagation()}else{c.cancelBubble=true;c.returnValue=false}return false}});a.register("core.evt.preventDefault",function(b){return function(c){c=c||b.core.evt.getEvent();if(c.preventDefault){c.preventDefault()}else{c.returnValue=false}}});a.register("core.func.empty",function(){return function(){}});a.register("core.dom.removeNode",function(b){return function(c){c=b.E(c)||c;try{c.parentNode.removeChild(c)}catch(d){}}});a.register("core.util.getUniqueKey",function(d){var b=(new Date()).getTime().toString(),c=1;return function(){return b+(c++)}});a.register("core.str.parseURL",function(b){return function(e){var d=/^(?:([A-Za-z]+):(\/{0,3}))?([0-9.\-A-Za-z]+\.[0-9A-Za-z]+)?(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/;var j=["url","scheme","slash","host","port","path","query","hash"];var g=d.exec(e);var h={};for(var f=0,c=j.length;f<c;f+=1){h[j[f]]=g[f]||""}return h}});a.register("core.json.queryToJson",function(b){return function(e,j){var l=b.core.str.trim(e).split("&");var k={};var d=function(i){if(j){return decodeURIComponent(i)}else{return i}};for(var g=0,h=l.length;g<h;g++){if(l[g]){var f=l[g].split("=");var c=f[0];var m=f[1];if(f.length<2){m=c;c="$nullName"}if(!k[c]){k[c]=d(m)}else{if(b.core.arr.isArray(k[c])!=true){k[c]=[k[c]]}k[c].push(d(m))}}}return k}});a.register("core.json.jsonToQuery",function(b){var c=function(e,d){e=e==null?"":e;e=b.core.str.trim(e.toString());if(d){return encodeURIComponent(e)}return e};return function(h,f){var j=[];if(typeof h=="object"){for(var e in h){if(e==="$nullName"){j=j.concat(h[e]);continue}if(h[e] instanceof Array){for(var g=0,d=h[e].length;g<d;g++){j.push(e+"="+c(h[e][g],f))}}else{if(typeof h[e]!="function"){j.push(e+"="+c(h[e],f))}}}}if(j.length){return j.join("&")}return""}});a.register("core.util.URL",function(b){return function(g,d){var f=b.core.obj.parseParam({isEncodeQuery:false,isEncodeHash:false},d||{});var e={};var i=b.core.str.parseURL(g);var c=b.core.json.queryToJson(i.query);var h=b.core.json.queryToJson(i.hash);e.setParam=function(j,k){c[j]=k;return this};e.getParam=function(j){return c[j]};e.setParams=function(k){for(var j in k){e.setParam(j,k[j])}return this};e.setHash=function(j,k){h[j]=k;return this};e.getHash=function(j){return h[j]};e.valueOf=e.toString=function(){var j=[];var k=b.core.json.jsonToQuery(c,f.isEncodeQuery);var l=b.core.json.jsonToQuery(h,f.isEncodeQuery);if(i.scheme!=""){j.push(i.scheme+":");j.push(i.slash)}if(i.host!=""){j.push(i.host);if(i.port!=""){j.push(":");j.push(i.port)}}j.push("/");j.push(i.path);if(k!=""){j.push("?"+k)}if(l!=""){j.push("#"+l)}return j.join("")};return e}});a.register("core.io.scriptLoader",function(c){var d={};var b={url:"",charset:"UTF-8",timeout:30*1000,args:{},onComplete:c.core.func.empty,onTimeout:c.core.func.empty,isEncode:false,uniqueID:null};return function(i){var g,e;var f=c.core.obj.parseParam(b,i);if(f.url==""){throw"scriptLoader: url is null"}var h=f.uniqueID||c.core.util.getUniqueKey();g=d[h];if(g!=null&&c.IE!=true){c.core.dom.removeNode(g);g=null}if(g==null){g=d[h]=c.C("script")}g.charset=f.charset;g.id="scriptRequest_script_"+h;g.type="text/javascript";if(f.onComplete!=null){if(c.IE){g.onreadystatechange=function(){if(g.readyState.toLowerCase()=="loaded"||g.readyState.toLowerCase()=="complete"){try{clearTimeout(e);document.getElementsByTagName("head")[0].removeChild(g);g.onreadystatechange=null}catch(j){}f.onComplete()}}}else{g.onload=function(){try{clearTimeout(e);c.core.dom.removeNode(g)}catch(j){}f.onComplete()}}}g.src=c.core.util.URL(f.url,{isEncodeQuery:f.isEncode}).setParams(f.args).toString();document.getElementsByTagName("head")[0].appendChild(g);if(f.timeout>0){e=setTimeout(function(){try{document.getElementsByTagName("head")[0].removeChild(g)}catch(j){}f.onTimeout()},f.timeout)}return g}});a.register("core.io.jsonp",function(b){return function(g){var e=b.core.obj.parseParam({url:"",charset:"UTF-8",timeout:30*1000,args:{},onComplete:null,onTimeout:null,responseName:null,isEncode:false,varkey:"callback"},g);var h=-1;var f=e.responseName||("STK_"+b.core.util.getUniqueKey());e.args[e.varkey]=f;var c=e.onComplete;var d=e.onTimeout;window[f]=function(i){if(h!=2&&c!=null){h=1;c(i)}};e.onComplete=null;e.onTimeout=function(){if(h!=1&&d!=null){h=2;d()}};return b.core.io.scriptLoader(e)}});a.register("core.arr.indexOf",function(b){return function(e,f){if(f.indexOf){return f.indexOf(e)}for(var d=0,c=f.length;d<c;d++){if(f[d]===e){return d}}return -1}});a.register("core.arr.inArray",function(b){return function(c,d){return b.core.arr.indexOf(c,d)>-1}});a.register("core.json.merge",function(d){var c=function(f){if(f===undefined){return true}if(f===null){return true}if(d.core.arr.inArray((typeof f),["number","string","function","boolean"])){return true}if(d.core.dom.isNode(f)){return true}return false};var b=function(h,l,m){if(c(m)){h[l]=m;return}if(d.core.arr.isArray(m)){if(!d.core.arr.isArray(h[l])){h[l]=[]}for(var j=0,f=m.length;j<f;j+=1){b(h[l],j,m[j])}return}if(typeof m==="object"){if(c(h[l])||d.core.arr.isArray(h[l])){h[l]={}}for(var g in m){b(h[l],g,m[g])}return}};var e=function(h,j,g){var i={};if(g){for(var f in h){b(i,f,h[f])}for(var f in j){b(i,f,j[f])}}else{for(var f in h){i[f]=h[f]}for(var f in j){i[f]=j[f]}}return i};return function(f,i,h){var g=d.core.obj.parseParam({isDeep:false},h);return e(f,i,g.isDeep)}});a.register("core.obj.beget",function(c){var b=function(){};return function(d){b.prototype=d;return new b()}});a.register("core.str.encodeHTML",function(b){return function(c){if(typeof c!=="string"){throw"encodeHTML need a string as parameter"}return c.replace(/\&/g,"&amp;").replace(/"/g,"&quot;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\'/g,"&#39;").replace(/\u00A0/g,"&nbsp;").replace(/(\u0020|\u000B|\u2028|\u2029|\f)/g,"&#32;")}});a.register("core.str.bLength",function(b){return function(d){if(!d){return 0}var c=d.match(/[^\x00-\xff]/g);return(d.length+(!c?0:c.length))}});a.register("core.str.leftB",function(b){return function(e,c){var d=e.replace(/\*/g," ").replace(/[^\x00-\xff]/g,"**");e=e.slice(0,d.slice(0,c).replace(/\*\*/g," ").replace(/\*/g,"").length);if(b.core.str.bLength(e)>c&&c>0){e=e.slice(0,e.length-1)}return e}});a.register("core.evt.custEvent",function(d){var i="__custEventKey__",c=1,h={},e=function(m,l){var k=(typeof m=="number")?m:m[i];return(k&&h[k])&&{obj:(typeof l=="string"?h[k][l]:h[k]),key:k}};var g={};var j=function(p,m,l,n,k){if(p&&typeof m=="string"&&l){var o=e(p,m);if(!o||!o.obj){throw"custEvent ("+m+") is undefined !"}o.obj.push({fn:l,data:n,once:k});return o.key}};var b=function(m,t,r,n){var v=true;var p=function(){v=false};if(m&&typeof t=="string"){var k=e(m,t),q;if(k&&(q=k.obj)){r=typeof r!="undefined"&&[].concat(r)||[];for(var l=q.length-1;l>-1&&q[l];l--){var u=q[l].fn;var s=q[l].once;if(u&&u.apply){try{u.apply(m,[{obj:m,type:t,data:q[l].data,preventDefault:p}].concat(r));if(s){q.splice(l,1)}}catch(o){d.log("[error][custEvent]"+o.message,o,o.stack)}}}if(v&&d.core.func.getType(n)==="function"){n()}return k.key}}};var f={define:function(o,m){if(o&&m){var l=(typeof o=="number")?o:o[i]||(o[i]=c++),n=h[l]||(h[l]={});m=[].concat(m);for(var k=0;k<m.length;k++){n[m[k]]||(n[m[k]]=[])}return l}},undefine:function(n,m){if(n){var l=(typeof n=="number")?n:n[i];if(l&&h[l]){if(m){m=[].concat(m);for(var k=0;k<m.length;k++){if(m[k] in h[l]){delete h[l][m[k]]}}}else{delete h[l]}}}},add:function(n,l,k,m){return j(n,l,k,m,false)},once:function(n,l,k,m){return j(n,l,k,m,true)},remove:function(p,n,m){if(p){var o=e(p,n),q,k;if(o&&(q=o.obj)){if(d.core.arr.isArray(q)){if(m){var l=0;while(q[l]){if(q[l].fn===m){break}l++}q.splice(l,1)}else{q.splice(0,q.length)}}else{for(var l in q){q[l]=[]}}return o.key}}},fire:function(n,m,k,l){return b(n,m,k,l)},hook:function(t,v,n){if(!t||!v||!n){return}var q=[],o=t[i],r=o&&h[o],l,u=v[i]||(v[i]=c++),k;if(r){k=g[o+"_"+u]||(g[o+"_"+u]={});var s=function(x){var w=true;b(v,k[x.type].type,Array.prototype.slice.apply(arguments,[1,arguments.length]),function(){w=false});w&&x.preventDefault()};for(var p in n){var m=n[p];if(!k[p]){if(l=r[p]){l.push({fn:s,data:undefined});k[p]={fn:s,type:m};q.push(m)}}}f.define(v,q)}},unhook:function(r,l,q){if(!r||!l||!q){return}var n=r[i],p=l[i],k=g[n+"_"+p];if(k){for(var m in q){var o=q[m];if(k[m]){f.remove(r,m,k[m].fn)}}}},destroy:function(){h={};c=1;g={}}};return f});a.register("core.util.drag",function(d){var b=function(f){f.cancelBubble=true;return false};var c=function(f,e){f.clientX=e.clientX;f.clientY=e.clientY;f.pageX=e.clientX+d.core.util.scrollPos()["left"];f.pageY=e.clientY+d.core.util.scrollPos()["top"];return f};return function(f,n){if(!d.core.dom.isNode(f)){throw"core.util.drag need Element as first parameter"}var m=d.core.obj.parseParam({actRect:[],actObj:{}},n);var j={};var k=d.core.evt.custEvent.define(m.actObj,"dragStart");var g=d.core.evt.custEvent.define(m.actObj,"dragEnd");var h=d.core.evt.custEvent.define(m.actObj,"draging");var l=function(p){var o=c({},p);document.body.onselectstart=function(){return false};d.core.evt.addEvent(document,"mousemove",i);d.core.evt.addEvent(document,"mouseup",e);d.core.evt.addEvent(document,"click",b,true);if(p.preventDefault){p.preventDefault();p.stopPropagation()}d.core.evt.custEvent.fire(k,"dragStart",o);return false};var i=function(p){var o=c({},p);p.cancelBubble=true;d.core.evt.custEvent.fire(k,"draging",o)};var e=function(p){var o=c({},p);document.body.onselectstart=function(){return true};d.core.evt.removeEvent(document,"mousemove",i);d.core.evt.removeEvent(document,"mouseup",e);d.core.evt.removeEvent(document,"click",b,true);d.core.evt.custEvent.fire(k,"dragEnd",o)};d.core.evt.addEvent(f,"mousedown",l);j.destroy=function(){d.core.evt.removeEvent(f,"mousedown",l);m=null};j.getActObj=function(){return m.actObj};return j}});a.register("core.util.cookie",function(c){var b={set:function(h,k,j){var e=[];var i,g;var f=c.core.obj.parseParam({expire:null,path:"/",domain:null,secure:null,encode:true},j);if(f.encode==true){k=escape(k)}e.push(h+"="+k);if(f.path!=null){e.push("path="+f.path)}if(f.domain!=null){e.push("domain="+f.domain)}if(f.secure!=null){e.push(f.secure)}if(f.expire!=null){i=new Date();g=i.getTime()+f.expire*3600000;i.setTime(g);e.push("expires="+i.toGMTString())}document.cookie=e.join(";")},get:function(f){f=f.replace(/([\.\[\]\$])/g,"\\$1");var e=new RegExp(f+"=([^;]*)?;","i");var g=document.cookie+";";var d=g.match(e);if(d){return d[1]||""}else{return""}},remove:function(d,e){e=e||{};e.expire=-10;b.set(d,"",e)}};return b});a.register("core.util.language",function(b){return function(e,g){var f=[];for(var d=2,c=arguments.length;d<c;d+=1){f.push(arguments[d])}return e.replace(/#L\{((.*?)(?:[^\\]))\}/ig,function(){var i=arguments[1];var h;if(g&&g[i]!==undefined){h=g[i]}else{h=i}if(f.length){h=h.replace(/(\%s)/ig,function(){var j=f.shift();if(j!==undefined){return j}else{return arguments[0]}})}return h})}});a.register("core.util.listener",function(b){return(function(){var d={};var e=[];var c;var f=function(){if(e.length==0){return}clearTimeout(c);var g=e.splice(0,1)[0];try{g.func.apply(g.func,[].concat(g.data))}catch(h){}c=setTimeout(f,25)};return{register:function(g,i,h){d[g]=d[g]||{};d[g][i]=d[g][i]||[];d[g][i].push(h)},fire:function(j,l,m){var k;var h,g;if(d[j]&&d[j][l]&&d[j][l].length>0){k=d[j][l];k.data_cache=m;for(h=0,g=k.length;h<g;h++){e.push({channel:j,evt:l,func:k[h],data:m})}f()}},remove:function(j,l,k){if(d[j]){if(d[j][l]){for(var h=0,g=d[j][l].length;h<g;h++){if(d[j][l][h]===k){d[j][l].splice(h,1);break}}}}},list:function(){return d},cache:function(g,h){if(d[g]&&d[g][h]){return d[g][h].data_cache}}}})()});(function(){var c=a.core;var d={isNode:c.dom.isNode,Ready:c.dom.ready,setStyle:c.dom.setStyle,getStyle:c.dom.getStyle,addClassName:c.dom.addClassName,hasClassName:c.dom.hasClassName,removeClassName:c.dom.removeClassName,contains:c.dom.contains,position:c.dom.position,foreach:c.arr.foreach,isArray:c.arr.isArray,addEvent:c.evt.addEvent,removeEvent:c.evt.removeEvent,getEvent:c.evt.getEvent,stopEvent:c.evt.stopEvent,preventDefault:c.evt.preventDefault,getType:c.func.getType,funcEmpty:c.func.empty,jsonp:c.io.jsonp,scriptLoader:c.io.scriptLoader,merge:c.json.merge,jsonToQuery:c.json.jsonToQuery,beget:c.obj.beget,parseParam:c.obj.parseParam,bLength:c.str.bLength,leftB:c.str.leftB,trim:c.str.trim,encodeHTML:c.str.encodeHTML,cookie:c.util.cookie,drag:c.util.drag,listener:c.util.listener,browser:c.util.browser,language:c.language,getUniqueKey:c.util.getUniqueKey};for(var b in d){if(d[b]){a.regShort(b,d[b])}}})();a.register("common.listener",function(c){var d={};var b={};b.define=function(f,g){if(d[f]!=null){throw"common.listener.define: 频道已被占用"}d[f]=g;var e={};e.register=function(i,h){if(d[f]==null){throw"common.listener.define: 频道未定义"}c.core.util.listener.register(f,i,h)};e.fire=function(h,i){if(d[f]==null){throw"commonlistener.define: 频道未定义"}c.core.util.listener.fire(f,h,i)};e.remove=function(i,h){c.core.util.listener.remove(f,i,h)};return e};return b});a.register("common.channel.plugin",function(b){return b.common.listener.define("common.channel.plugin",["outlogin_ready","plugin_ready","weibolist_show","weibolist_hide"])});a.register("kit.obj.append",function(b){return function(g){for(var f=1,d=arguments.length;f<d;f++){var c=arguments[f]||{};for(var e in c){g[e]=c[e]}}return g}});a.register("kit.dom.builder",function(c){var b=null;return function(d){var e=null;if(typeof(d)=="string"){if(!b){b=c.C("div")}b.innerHTML=d;e=b.children[0];b.removeChild(e);b.innerHTML=""}else{e=d}var g={};var f=e.getElementsByTagName("*");if(f.length>0){c.foreach(f,function(j){if(c.isNode(j)){var i=j.getAttribute("node-type");if(i){if(!g[i]){g[i]=[]}g[i].push(j)}}})}var h={};h.box=e;h.list=g;return h}});a.register("kit.dom.parseDOM",function(b){return function(d){for(var c in d){if(d[c]&&(d[c].length==1)){d[c]=d[c][0]}}return d}});a.register("kit.dom.loadStyle",function(e){var d;var c=e.funcEmpty;var b=e.core.util.browser;return function(g,n){var m,h,j=false,l=false;var k=e.parseParam({id:e.getUniqueKey(),timeout:30*1000,styleCheck:null,onLoad:c,onTimeout:c,props:{charset:"utf-8",rel:"stylesheet",media:"screen",type:"text/css"}},n);m=e.C("link");e.foreach(k.props,function(p,o){m[o]=p});m.id=k.id;m.href=g;var f=function(){clearInterval(h);if(!l&&!j){if(e.getType(k.onLoad)==="function"){setTimeout(k.onLoad,100)}}j=true};if(b.IE){m.onload=f}else{if(e.getType(k.styleCheck)==="function"){h=setInterval(function(){if(k.styleCheck()){f()}},10)}else{var i=document.createElement("img");i.onerror=f;i.src=g}}if(k.timeout&&k.onTimeout){setTimeout(function(){clearInterval(h);if(!j&&e.getType(k.onTimeout)==="function"){l=true;k.onTimeout()}},k.timeout)}if(!d){d=document.getElementsByTagName("head")[0]}d.appendChild(m)}});a.register("kit.dom.appendStyle",function(b){return function(f,c){var d=b.parseParam({autoAppend:true,target:null,type:"text/css"},c);var e;f=f||"";f=f.toString();if(b.isNode(d.target)&&d.target.tagName.toLowerCase()==="style"){e=d.target}else{e=document.createElement("style");e.setAttribute("type",d.type)}if(e.styleSheet){e.styleSheet.cssText=e.innerHTML+f}else{e.appendChild(document.createTextNode(f))}if(d.autoAppend){document.getElementsByTagName("head")[0].appendChild(e)}return e}});a.register("kit.util.makeReady",function(b){return function(d){var e=b.parseParam({timeout:30*1000,condition:b.funcEmpty,ready:b.funcEmpty},d);var c,f;return{reset:function(){if(c){c.length=0;c=null}if(f){clearTimeout(f);f=null}},exec:function(g){var h=this;if(b.getType(g)==="function"){if(e.condition()){g()}else{if(!c){c=[];c.push(g);if(!f){f=setTimeout(h.reset,e.timeout)}e.ready(function(){clearTimeout(f);f=null;while(b.getType(c)==="array"&&c.length>0){c.shift()()}})}else{c.push(g)}}}},destroy:function(){this.reset()}}}});a.register("comp.defaultStyle",function(c){var b=['.tn-title-login-custom{float:left!important;font-family: "Microsoft YaHei","微软雅黑","SimSun","宋体"!important;position:relative!important;}',".tn-title-login-custom .tn-user-custom{float:left!important;font-size:12px!important;}",".tn-title-login-custom .tn-user-greet{float:left!important;height:17px!important;padding:12px 0!important;width:51px!important; line-height:17px!important;overflow:hidden!important;}",".tn-title-login-custom .tn-tab-custom{position:relative!important;float:left!important;border-width:0 1px!important;border-style:solid!important;width:85px!important;height:17px!important;padding:12px 0!important;_padding:14px 0 10px!important;text-align:center!important;font-style:normal!important;text-decoration:none!important; vertical-align:top!important;}",".tn-title-login-custom .tn-tab-custom-login{width:57px!important;_float:left;}",".tn-title-login-custom .tn-tab-custom i{font-style:normal!important;}",".tn-title-login-custom .tn-tab-custom:hover{text-decoration:none!important;}",".tn-title-login-custom .tn-tab-custom .tn-new-custom{display:none;position:absolute!important;right:2px!important;margin-top:-10px!important;height:11px!important;width:13px!important;padding-left:3px!important;font-size:8px!important;overflow:hidden!important;line-height:10px!important;text-align:center!important;-webkit-text-size-adjust:none!important;font-style:normal!important;}",".tn-title-login-custom .tn-tab-custom .tn-arrow-custom{display: inline-block!important;font-size: 12px!important;height: 5px!important;line-height: 13px!important;margin: 0 0 0 5px!important;overflow: hidden!important;transform: none!important;vertical-align: middle!important;width:9px!important;font-style:normal!important;}",".tn-title-login-custom .tn-topmenulist-custom{position:absolute!important;right:0!important;top:41px!important;border-width:1px 1px 0!important;border-style:solid!important;width:85px!important;overflow:hidden!important;}",".tn-title-login-custom .tn-topmenulist-custom .tn-text-list{margin-bottom:-2px!important;margin:0!important;padding:0!important;}",".tn-title-login-custom .tn-topmenulist-custom li{border-bottom-width:1px!important;border-bottom-style:solid!important;line-height:31px!important; list-style:none!important;margin:0!important;padding:0!important;}",".tn-title-login-custom .tn-topmenulist-custom a{display:block!important;padding:0 15px!important;text-decoration:none!important;text-align:left!important;}",".tn-title-login-custom .tn-topmenulist-custom a em{float:right!important;font-style:normal!important;}",".tn-title-login-custom .tn-topmenulist-custom a:hover{text-decoration:none!important;}",".tn-title-login-custom .tn-topmenulist-custom a.tn-user-custom-logout{background:#f2f2f2!important;color:#0a8cd2!important;}",".tn-title-login-custom .tn-topmenulist-custom a.tn-user-custom-logout:hover{text-decoration:underline!important;}","/*可覆盖样式区域*/",".tn-title-login-custom .tn-user-custom{background:#f7f7f7;}",".tn-title-login-custom .tn-tab-custom{border-color:#f7f7f7;color:#ff8601;}",".tn-title-login-custom .tn-tab-custom:hover,",".tn-title-login-custom .tn-tab-custom-onmouse{background:#eaeaea;border-color:#ff8503;color:#ff8601;}",".tn-title-login-custom .tn-tab-custom .tn-new-custom{background:url(http://i.sso.sina.com.cn/images/login/icon_custom.png) no-repeat 0 -30px;color:#fff;text-align:center;-webkit-text-size-adjust: none;}",".tn-title-login-custom .tn-tab-custom .tn-arrow-custom{ background:url(http://i.sso.sina.com.cn/images/login/icon_custom.png) no-repeat scroll 0 0 transparent; }",".tn-title-login-custom .tn-topmenulist-custom{border-color:#ff8601;background:#fff;}",".tn-title-login-custom .tn-topmenulist-custom li{border-bottom-color:#ff8601;}",".tn-title-login-custom .tn-topmenulist-custom a{color:#000;}",".tn-title-login-custom .tn-topmenulist-custom a em{color:#ff8603;}",".tn-title-login-custom .tn-topmenulist-custom a:hover{background:#fff6d9;color:#ff8601;}"];return{get:function(){if(typeof b!=="string"){b=b.join("\n")}return b}}});a.register("comp.userPanel",function(g){var t=g.core.json.merge,f=g.core.util.language,b=g.kit.dom.appendStyle,d=g.kit.dom.builder,h=g.kit.dom.parseDOM,m=g.kit.dom.loadStyle,r=g.kit.util.makeReady,p=g.comp.defaultStyle,k=g.common.channel.plugin;var o={};var j={};var l=0;var n;var c={layer:['<div class="top-nav">','<div class="tn-title-login-custom" node-type="userInfoContainer">','<div class="tn-user-custom" >','<a href="javascript:void(0);" class="tn-tab-custom tn-tab-custom-login" node-type="login"><i><span>#L{登录}</span></i></a>','<span class="tn-user-greet" style="display:none;" node-type="greet">#L{欢迎你，}</span>','<a node-type="nickCon" style="display:none;" href="http://weibo.com" target="_blank" class="tn-tab-custom"><i><span node-type="nick">&nbsp;</span>','<em class="tn-new-custom" node-type="totalMsg"></em>','<em class="tn-arrow tn-arrow-custom"></em></i></a>','<div class="tn-topmenulist-custom" node-type="infoList" style="display:none;">','<ul class="tn-text-list">','<li><a href="http://weibo.com/messages?topnav=1&wvr=4" target="_blank"><em node-type="pm"></em>#L{私信}</a></li>','<li><a href="http://weibo.com/comment/inbox?topnav=1&wvr=4&f=1" target="_blank"><em node-type="comment"></em>#L{评论}</a></li>','<li><a href="http://weibo.com/at/weibo?topnav=1&wvr=4" target="_blank"><em node-type="atme"></em>#L{@我}</a></li>','<li><a href="javascript:void(0);" node-type="logout" class="tn-user-custom-logout">#L{退出}</a></li>',"</ul>","</div>","</div>",'<div node-type="css_check" class="userpanel-checkload" style="display:none;"></div>',"</div>","</div>"].join("")};var i={};var q={};var e={container:{node:""},html:{layer:c.layer},extra:{css:"",outlogin:"http://i.sso.sina.com.cn/js/outlogin_layer.js",weibo:"https://rm.api.weibo.com/2/remind/unread_count.json"},outloginLayer:{ready:g.funcEmpty,options:{},triggerEvent:"click",loginBtns:[],setPos:false},style:{zIndex:1000,nickHoverCls:"tn-tab-custom-onmouse",itemHoverCls:""},language:{end:""}};g.$LANG=e.language;i.set=function(w,u){w=w.toString();u=u||{};var v=e[w];if(v){v=t(v,u);e[w]=v}return i};i.getOutLogin=function(){return window.SINA_OUTLOGIN_LAYER};i.init=function(){q.prepare()};q.prepareOutLogin=function(u){if(!q.outloginReady){q.outloginReady=r({condition:function(){return !!window.SINA_OUTLOGIN_LAYER},ready:function(v){g.scriptLoader({timeout:10*1000,url:e.extra.outlogin,onComplete:v,onTimeout:function(){q.outloginReady.reset()}})}})}q.outloginReady.exec(u)};var s=false;q.prepareCss=function(u){if(!q.cssReady){q.cssReady=r({condition:function(){return s},ready:function(v){b(p.get());if(e.extra.css){m(e.extra.css,{timeout:10*1000,styleCheck:function(){if(g.isNode(o.css_check)){var w=g.getStyle(o.css_check,"width");if(w==="123px"){return true}}},onLoad:function(){s=true;v()},onTimeout:function(){q.cssReady.reset()}})}else{s=true;v()}}})}q.cssReady.exec(u)};q.prepare=function(u){g.Ready(function(){q.build();q.prepareCss(function(){q.prepareOutLogin(function(){j=i.getOutLogin();q.bindEvent();if(g.getType(e.outloginLayer.ready)==="function"){e.outloginLayer.ready()}k.fire("outlogin_ready");if(g.getType(u)==="function"){u()}})})})};q.build=function(){q.parseDom();q.insert()};q.parseDom=function(){if(!g.isNode(o.box)){var u=f(e.html.layer,e.language);var v=d(u);i.nodes=o=h(v.list);o.box=v.box}};q.insert=function(){if(!g.isNode(o.box)){return}var u=e.container.node;if(!g.isNode(u)){u=document.body}u.appendChild(o.box);g.setStyle(o.box,"display","none")};q.displayLogin=function(){g.setStyle(o.login,"display","");g.setStyle(o.nickCon,"display","none");g.setStyle(o.greet,"display","none")};q.displayUserInfo=function(){g.setStyle(o.login,"display","none");g.setStyle(o.nickCon,"display","");g.setStyle(o.greet,"display","");if(e.style.nickHoverCls){g.removeClassName(o.nickCon,e.style.nickHoverCls)}};q.bindEvent=function(){g.setStyle(o.box,"display","");j.register("layer_ready",function(){j.set("drag",{enable:false});if(!e.outloginLayer.setPos){q.caculateLoginLayerPos();j.set("plugin",{position:"custom"})}g.addEvent(o.login,"click",function(){if(e.style.nickHoverCls){g.addClassName(o.login,e.style.nickHoverCls)}if(!e.outloginLayer.setPos){q.setLoginLayerPos()}j.show()});var u={sourceNode:o.login,layerNode:j.nodes.box,mouseoverFun:function(){if(e.style.nickHoverCls){g.addClassName(o.login,e.style.nickHoverCls)}j.show()},mouseoutFun:function(){if(e.style.nickHoverCls){g.removeClassName(o.login,e.style.nickHoverCls)}j.hide()}};q.loginHover=q.hoverEvents(u);var u={sourceNode:o.nickCon,layerNode:o.infoList,mouseoverFun:q.show,mouseoutFun:q.hide};q.hoverEvents(u);q.bindMsgClick();var v=function(A){if(q.loginHover){clearTimeout(q.loginHover.timer)}var A=g.getEvent(A);var y=A.target||A.srcElement;var x=true;var B=e.outloginLayer.loginBtns;for(var w=0;w<B.length;w++){var z=B[w];if(!g.isNode(z)){z=g.E(z)}if(g.contains(z,y)||z==y){x=false}}if(g.contains(o.box,y)||o.box==y){x=false}if(!g.contains(j.nodes.box,y)&&x&&y!==j.nodes.box){if(e.style.nickHoverCls){g.removeClassName(o.login,e.style.nickHoverCls)}setTimeout(j.hide,10)}};g.addEvent(document,"touchstart",v);g.addEvent(document,"mousedown",v);k.fire("plugin_ready")}).register("login_success",function(){q.displayUserInfo();q.checkMsgList();q.getNickName()}).register("logout_success",function(){q.resetInfoList();clearTimeout(q.timeout);g.removeClassName(o.nickCon,e.style.nickHoverCls);g.setStyle(o.infoList,"display","none");q.displayLogin()})};q.resetInfoList=function(){l=0;g.setStyle(o.totalMsg,"display","none");o.totalMsg.innerHTML="";o.pm.innerHTML="";o.comment.innerHTML="";o.atme.innerHTML=""};q.caculateLoginLayerPos=function(){g.setStyle(j.nodes.box,"position","absolute");g.setStyle(j.nodes.box,"top","-1000px");g.setStyle(j.nodes.box,"left","-1000px");g.setStyle(j.nodes.box,"display","");var v=o.login.offsetWidth,u=o.box.offsetHeight||o.userInfoContainer.offsetHeight,x=j.nodes.root.offsetWidth;v=parseInt(v,10),u=parseInt(u,10);x=parseInt(x,10);var w=g.position(o.login);var y=w.l+v-x;n={};n.left=y+110+"px";n.top=u+"px"};q.setLoginLayerPos=function(){if(n){j.set("styles",{top:n.top,left:n.left})}};q.bindMsgClick=function(){g.addEvent(o.pm.parentNode,"click",function(){l-=parseInt(o.pm.innerHTML,10);o.pm.innerHTML="";u()});g.addEvent(o.comment.parentNode,"click",function(){l-=parseInt(o.comment.innerHTML,10);o.comment.innerHTML="";u()});g.addEvent(o.atme.parentNode,"click",function(){l-=parseInt(o.atme.innerHTML,10);o.atme.innerHTML="";u()});g.addEvent(o.logout,"click",function(){clearTimeout(q.timeout);q.resetInfoList();j.logout()});function u(){if(l>0){g.setStyle(o.totalMsg,"display","inline-block");o.totalMsg.innerHTML=l}else{g.setStyle(o.totalMsg,"display","none");o.totalMsg.innerHTML=""}}};q.checkMsgList=function(){var u=j.getSinaCookie();if(u&&u.uid){try{g.jsonp({timeout:59*1000,url:e.extra.weibo,args:{source:"2751753920",uid:u.uid},onComplete:function(w){q.renderMsgList(w.data)},onTimeout:function(){q.renderMsgList(res.data)}})}catch(v){}}q.timeout=setTimeout(arguments.callee,60*1000)};q.renderMsgList=function(v){var u=j.getSinaCookie();if(u&&u.uid){l=v.dm+v.cmt+v.mention_cmt+v.mention_status;if(l){g.setStyle(o.totalMsg,"display","inline-block");o.totalMsg.innerHTML=l;o.pm.innerHTML=v.dm?v.dm:"";o.comment.innerHTML=v.cmt?v.cmt:"";o.atme.innerHTML=(v.mention_status+v.mention_cmt)?(v.mention_status+v.mention_cmt):""}else{g.setStyle(o.totalMsg,"display","none");q.resetInfoList()}}};q.show=function(){try{g.preventDefault()}catch(v){}var u=q.isDisplay();if(!u){if(o.infoList){g.setStyle(o.infoList,"display","")}if(e.style.nickHoverCls){g.addClassName(o.nickCon,e.style.nickHoverCls)}}k.fire("weibolist_show")};q.hide=function(){try{g.preventDefault()}catch(u){}if(o.infoList){g.setStyle(o.infoList,"display","none")}if(e.style.nickHoverCls){g.removeClassName(o.nickCon,e.style.nickHoverCls)}k.fire("weibolist_hide")};q.isDisplay=function(){return o.infoList?g.getStyle(o.infoList,"display")!=="none":false};q.hoverEvents=function(u){var v={};var w={sourceNode:"",layerNode:"",mouseoverFun:g.funcEmpty,mouseoutFun:g.funcEmpty};w=t(w,u);w.layerNode.toggleType="nomarl";g.addEvent(w.sourceNode,"mouseover",function(){w.layerNode.toggleType="hover";v.visible=true;if(!e.outloginLayer.setPos&&w.sourceNode==o.login){q.setLoginLayerPos()}y()});g.addEvent(w.sourceNode,"mouseout",function(){v.visible=false;y()});g.addEvent(w.layerNode,"mouseover",function(z){v.visible=true;y()});g.addEvent(w.layerNode,"mouseout",function(z){v.visible=false;y()});function y(){if(v.visible){if(v.timer){clearTimeout(v.timer);delete v.timer}w.mouseoverFun()}else{v.timer=setTimeout(function(){if(w.layerNode.toggleType==="hover"&&!x()){w.mouseoutFun()}delete v.timer},500)}}function x(){if(j.isLogin()){return false}else{var A=document.activeElement;var B=j.nodes.loginname.value,z=j.nodes.password.value;return(B||z||g.contains(j.nodes.box,A))}}return v};q.getNickName=function(){var v=j.getSinaCookie();if(v&&v.uid){j.getWeiboInfo({timeout:30*1000,onSuccess:function(w){o.nick.innerHTML=u(w.data.name);o.nickCon.href="http://weibo.com/u/"+v.uid},onFailure:function(){o.nick.innerHTML=u(v.nick);o.pm.parentNode.href="http://weibo.com";o.comment.parentNode.href="http://weibo.com";o.atme.parentNode.href="http://weibo.com"}})}function u(w){if(g.bLength(w)>8){var w=g.leftB(w,8);return w+"..."}return w}};i.register=function(v,u){k.register(v,u);return i};i.remove=function(v,u){k.remove(v,u);return i};i.nodes=o;i.options=e;return i});(function(c){var b=a.comp.userPanel;b.listener=c.common.channel.plugin;b.getVersion=function(){return"1.0.2"};b.STK=a;this.SINA_USER_PANEL=b}).call(this,a)}).call(this);